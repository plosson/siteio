{"id":"siteio-2dt","title":"Fix handleAuthCheck to check static sites","description":"The handleAuthCheck method only checks appStorage, not siteStorage. When a site is not found as an app, it returns 200 (passthrough) instead of checking if it's a static site with OAuth configured.","status":"closed","priority":1,"issue_type":"bug","owner":"palosson@hex-rays.com","created_at":"2026-01-30T07:05:28.319004+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T07:06:48.313383+01:00","closed_at":"2026-01-30T07:06:48.313383+01:00","close_reason":"Refactored handleAuthCheck to check both appStorage and siteStorage for OAuth config"}
{"id":"siteio-3nb","title":"Add Traefik config tests for site OAuth","description":"Add tests in traefik-manager.test.ts: site with OAuth gets middleware, site without OAuth has no middleware, adding/removing OAuth updates config correctly.","status":"closed","priority":2,"issue_type":"task","owner":"palosson@hex-rays.com","created_at":"2026-01-30T07:05:36.866121+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T07:12:11.384342+01:00","closed_at":"2026-01-30T07:12:11.384342+01:00","close_reason":"Added 5 tests for site OAuth in Traefik config: site with/without OAuth, server without oauthConfig, mixed OAuth settings","dependencies":[{"issue_id":"siteio-3nb","depends_on_id":"siteio-2dt","type":"blocks","created_at":"2026-01-30T07:05:42.343901+01:00","created_by":"Pierre-Alexandre Losson"}]}
{"id":"siteio-58p","title":"TLS status: verify actual cert being served using TLS connection","description":"Current TLS check shows ✓ even when Traefik is still serving default cert. Need to make actual TLS connection and verify issuer is Let's Encrypt before showing valid status.\n\n**Problem proven by Playwright test:**\n- siteio reports TLS ✓\n- Browser gets ERR_CERT_AUTHORITY_INVALID\n- Cert exists in acme.json but Traefik hasn't reloaded it yet\n\n**Solution:**\nUse Node/Bun TLS module to connect and check cert.issuer.O === 'Let's Encrypt'","design":"## Plan\n\n### 1. Add TLS verification method to TraefikManager\n\nAdd a new private method `verifyActualCert(domain: string)` that:\n- Uses Node/Bun `tls.connect()` to connect to the domain on port 443\n- Gets peer certificate with `socket.getPeerCertificate()`\n- Returns 'valid' if issuer.O === 'Let's Encrypt'\n- Returns 'pending' if using default/self-signed cert\n- Returns 'error' on connection failure\n- Has 5 second timeout\n\n### 2. Update getAllRoutersTlsStatus()\n\nModify the existing method to:\n1. First check acme.json (fast path) - if no cert entry, return 'pending'\n2. If cert exists in acme.json, call verifyActualCert() to confirm it's being served\n3. Return 'valid' only when actual cert is from Let's Encrypt\n\n### 3. Handle performance\n\n- TLS check adds ~100ms per domain\n- For sites list with many domains, this could add up\n- Consider: parallel checks with Promise.all()\n\n### 4. Files to modify\n\n- `src/lib/agent/traefik.ts` - add verifyActualCert(), update getAllRoutersTlsStatus()\n\n### 5. Testing\n\n- Unit test: mock TLS connection\n- E2E test: deploy site, immediately check status shows 'pending', wait, check shows 'valid'","status":"in_progress","priority":1,"issue_type":"bug","owner":"palosson@hex-rays.com","created_at":"2026-01-30T15:15:46.376298+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T15:16:10.148591+01:00"}
{"id":"siteio-7fb","title":"Add CLI sites auth command tests","description":"Add tests for CLI commands: sites auth with --allowed-emails, --allowed-domain, --allowed-groups, --add-email, --remove-email, --remove. Spawn CLI against test server.","status":"closed","priority":2,"issue_type":"task","owner":"palosson@hex-rays.com","created_at":"2026-01-30T07:05:35.918995+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T07:10:54.162141+01:00","closed_at":"2026-01-30T07:10:54.162141+01:00","close_reason":"Added 14 CLI tests in sites-auth.test.ts covering --allowed-emails/domain/groups, --add-email/domain/group, --remove-email/domain/group, --remove, case handling","dependencies":[{"issue_id":"siteio-7fb","depends_on_id":"siteio-2dt","type":"blocks","created_at":"2026-01-30T07:05:42.269166+01:00","created_by":"Pierre-Alexandre Losson"}]}
{"id":"siteio-9dx","title":"Show HTTPS/TLS certificate status in sites ls and apps ls","description":"Query Traefik API internally to get router TLS status. Show https column in sites ls / apps ls with status: pending, valid, error. Enable Traefik API (internal only) and query /api/http/routers for certificate status. Cannot test actual Let's Encrypt locally but can test Traefik API integration with mocked/test responses.","status":"closed","priority":2,"issue_type":"feature","owner":"palosson@hex-rays.com","created_at":"2026-01-30T12:14:12.816735+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T12:20:17.69854+01:00","closed_at":"2026-01-30T12:20:17.69854+01:00","close_reason":"Implemented TLS status via Traefik API with tests"}
{"id":"siteio-bwa","title":"Consolidated logs - multi-app log viewing","description":"Add ability to view logs from multiple apps at once:\n- `siteio apps logs --all` - Logs from all running apps\n- `siteio apps logs app1 app2 ...` - Logs from multiple named apps\n- Consider: `siteio logs` - Top-level command for consolidated view (apps + system)","status":"open","priority":2,"issue_type":"feature","owner":"palosson@hex-rays.com","created_at":"2026-01-30T05:27:21.146907+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T05:27:21.146907+01:00"}
{"id":"siteio-f0c","title":"Add confirmation prompt for rm commands with -y to force","description":"Add interactive confirmation prompt before destructive rm commands (apps rm, sites rm). Include a -y/--yes flag to skip confirmation for scripting/automation use cases.","status":"closed","priority":2,"issue_type":"feature","owner":"palosson@hex-rays.com","created_at":"2026-01-30T05:28:49.95287+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T06:46:44.688476+01:00","closed_at":"2026-01-30T06:46:44.688476+01:00","close_reason":"Added confirmation prompt to sites rm and apps rm commands with -y/--yes flag to skip"}
{"id":"siteio-rhj","title":"Add auth check tests for static sites","description":"Add tests in auth.test.ts for static site OAuth: site without OAuth (200), site with OAuth no email (401), allowed email (200), forbidden email (403), allowed domain (200), wrong domain (403), allowed groups (200), wrong groups (403), empty OAuth object.","status":"closed","priority":2,"issue_type":"task","owner":"palosson@hex-rays.com","created_at":"2026-01-30T07:05:33.405184+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T07:08:30.55751+01:00","closed_at":"2026-01-30T07:08:30.55751+01:00","close_reason":"Added 12 tests for static site OAuth in auth.test.ts covering: no OAuth, allowedEmails, allowedDomain, allowedGroups, case-insensitivity, multiple groups","dependencies":[{"issue_id":"siteio-rhj","depends_on_id":"siteio-2dt","type":"blocks","created_at":"2026-01-30T07:05:42.119183+01:00","created_by":"Pierre-Alexandre Losson"}]}
{"id":"siteio-vxo","title":"Add Site OAuth API endpoint tests","description":"Add tests in sites.test.ts for OAuth API: set OAuth via POST, get OAuth in site info, update OAuth (replace), add/remove email, remove all OAuth. Verify metadata persistence.","status":"closed","priority":2,"issue_type":"task","owner":"palosson@hex-rays.com","created_at":"2026-01-30T07:05:34.676539+01:00","created_by":"Pierre-Alexandre Losson","updated_at":"2026-01-30T07:09:46.955688+01:00","closed_at":"2026-01-30T07:09:46.955688+01:00","close_reason":"Added 14 OAuth API tests in sites-oauth.test.ts and 3 tests in sites.test.ts covering set/replace/remove OAuth, header-based OAuth, case normalization","dependencies":[{"issue_id":"siteio-vxo","depends_on_id":"siteio-2dt","type":"blocks","created_at":"2026-01-30T07:05:42.195334+01:00","created_by":"Pierre-Alexandre Losson"}]}
